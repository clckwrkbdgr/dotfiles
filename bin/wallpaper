#!/bin/bash
if [ -z "$1" ]; then
	echo "Sets specified wallpaper or chooses random if multiple files/directories are specified."
	echo "Usage: wallpaper <file/dir> [<file/dir> ...]"
	exit 1
fi

WALLPFILE=$(find "$@" -type f | shuf | head -1)

if [ ! -e "$WALLPFILE" ]; then
	echo "File was not found: $WALLPFILE"
	exit 1
fi

# Export variables via DBUS.
user=$(whoami)
pid="$(pgrep -u $user xfce4-session) $(pgrep -u $user gnome-panel)"
for dbusenv in $pid; do
	DBUS_SESSION_BUS_ADDRESS=$(grep -z DBUS_SESSION_BUS_ADDRESS /proc/$pid/environ | sed -e 's/DBUS_SESSION_BUS_ADDRESS=//')
	data="DBUS_SESSION_BUS_ADDRESS=$DBUS_SESSION_BUS_ADDRESS"
	eval " export $data"
done

#gconftool-2 -t string -s /desktop/gnome/background/picture_filename "$WALLPFILE"
#gsettings set org.gnome.desktop.background picture-uri "file://$WALLPFILE"
xfconf-query -c xfce4-desktop -p /backdrop/screen0/monitor0/workspace0/last-image -s "$WALLPFILE"
xfconf-query -c xfce4-desktop -p /backdrop/screen0/monitor0/workspace0/image-style -s 4 # Scaled
