#!/bin/bash
bring_to_top() { # <process name(s)>
	for pname in "$@"; do
		for pid in $(pgrep "$pname"); do
			if [ -z "$pid" ]; then
				continue
			fi
			xdotool search --pid "$pid" | while read window_id; do
				window_name="$(xdotool getwindowname $window_id)"
				if [ -z "$window_name" ]; then
					continue
				fi
				if xdotool windowactivate "$window_id" 2>&1 | fgrep -q 'XGetWindowProperty[_NET_WM_DESKTOP] failed (code=1)'; then
					:;
				else
					break
				fi
			done
		done
		return 0
	done
	return 1
}

#ulimit -Sm 4000000
#ulimit -Sv 1000000

browser=/usr/bin/iceweasel
pnames="iceweasel firefox-esr x-www-browser"

for f in "$@"; do
	if [ "${f}" == '--hide' ]; then
		HIDE=true
	elif [ "${f}" == '--activate' ]; then
		ACTIVATE=true
		HIDE=false
	fi
done
[ "$HIDE" != true ] && bring_to_top $pnames

if [ "$ACTIVATE" == true -a "$#" == 1 ]; then
	exit
fi
for f in "$@"; do
	if [ "${f}" == '--hide' ]; then
		continue
	fi
	echo "${f}" | sed 's/\r//g'
done | xargs -d '\n' $browser --
